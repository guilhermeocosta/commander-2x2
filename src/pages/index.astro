---
import BaseLayout from "../components/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Button from "../components/Button.astro";
import rawDecksData from "../data/decks.json";
import { DecksDataSchema } from "../schemas/deck";
import { Calendar, User } from "@lucide/astro";

BaseLayout;

const decksData = DecksDataSchema.parse(rawDecksData);
const items = decksData.decks
  .filter((deck) => deck.image_url?.trim())
  .map((deck) => ({
    img: deck.image_url,
    url: deck.url,
    commander: deck.commanders.join(" / "),
    date: deck.date,
    player: deck.player,
  }))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---

<BaseLayout
  title="Commander 2x2 - Formato competitivo em duplas"
  description="Um novo formato de Commander competitivo em duplas acessível e com uma comunidade crescente de jogadores."
>
  <Header />

  <main>
    <div class="hero bg-base-200">
      <div class="hero-content text-center px-4 py-32">
        <div class="max-w-md">
          <h1 class="text-3xl md:text-4xl font-bold text-primary">Faça parte do Commander 2x2</h1>
          <p class="py-6 text-base md:text-lg">
            Um novo formato de Commander competitivo em duplas acessível e com uma comunidade
            crescente de jogadores.
          </p>
          <Button href="/regras" variant="primary" size="lg" className="w-full md:w-auto">
            Conheça as Regras
          </Button>
        </div>
      </div>
    </div>

    <div class="pt-8">
      <div class="container mx-auto px-4">
        <h2 class="text-2xl font-bold mb-4">Decks em destaque</h2>

        <p>
          Inspire-se nos decks que melhor performaram em eventos anteriores. Participe e veja seus
          decks aqui!
        </p>
      </div>

      {
        items.length > 0 ? (
          <div class="overflow-hidden pt-2 w-full">
            <div class="flex gap-2 px-4 animated-carousel">
              {items.map(({ url, img, commander, date, player }) => (
                <div
                  class="group relative shrink-0 rounded-t-lg focus:outline-none focus:ring-4 focus:ring-primary focus:ring-offset-2"
                  tabindex="1"
                >
                  <div class="relative rounded-lg overflow-hidden translate-y-16 transition-transform duration-300 ease-out group-hover:translate-y-0 group-focus:translate-y-0">
                    <img class="h-72 rounded-lg" src={img} alt={`Deck de ${commander}`} />

                    <div class="absolute inset-x-0 bottom-0 p-3 pt-6 opacity-0 translate-y-2 transition-all duration-200 ease-out group-hover:opacity-100 group-hover:translate-y-0 group-focus:opacity-100 group-focus:translate-y-0 pointer-events-none">
                      <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/90 to-transparent" />
                      <div class="relative pointer-events-auto">
                        <ul class="space-y-1 mb-2">
                          <li class="text-white text-xs flex items-center gap-2">
                            <Calendar size={16} />
                            {new Date(date).toLocaleDateString("pt-BR")}
                          </li>
                          <li class="text-white text-sm flex items-center gap-2">
                            <User size={16} />
                            {player}
                          </li>
                        </ul>

                        <Button
                          href={url}
                          target="_blank"
                          size="sm"
                          className="w-full"
                          rel="noopener noreferrer"
                        >
                          Ver deck
                        </Button>
                      </div>
                    </div>
                  </div>
                </div>
              ))}

              {items.map(({ url, img, commander, date, player }) => (
                <div
                  class="group relative shrink-0 rounded-t-lg focus:outline-none focus:ring-4 focus:ring-primary focus:ring-offset-2"
                  tabindex="1"
                >
                  <div class="relative rounded-lg overflow-hidden translate-y-16 transition-transform duration-300 ease-out group-hover:translate-y-0 group-focus:translate-y-0">
                    <img class="h-72 rounded-lg" src={img} alt={`Deck de ${commander}`} />

                    <div class="absolute inset-x-0 bottom-0 p-3 pt-6 opacity-0 translate-y-2 transition-all duration-200 ease-out group-hover:opacity-100 group-hover:translate-y-0 group-focus:opacity-100 group-focus:translate-y-0 pointer-events-none">
                      <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/90 to-transparent" />
                      <div class="relative pointer-events-auto">
                        <ul class="space-y-1 mb-2">
                          <li class="text-white text-xs flex items-center gap-2">
                            <Calendar size={16} />
                            {new Date(date).toLocaleDateString("pt-BR")}
                          </li>
                          <li class="text-white text-sm flex items-center gap-2">
                            <User size={16} />
                            {player}
                          </li>
                        </ul>

                        <Button
                          href={url}
                          target="_blank"
                          size="sm"
                          className="w-full"
                          rel="noopener noreferrer"
                        >
                          Ver deck
                        </Button>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ) : (
          <div class="container mx-auto text-center py-8">
            <p class="text-base-content/70">Nenhum deck com imagem disponível no momento.</p>
          </div>
        )
      }
    </div>

    <div class="container mx-auto px-4 py-16">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title text-primary">Formato Único</h2>
            <p>Experiência competitiva de Commander em duplas com regras balanceadas.</p>
          </div>
        </div>

        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title text-primary">Acessível</h2>
            <p>Estratégias diversas são capazes de fazer ótimos resultados.</p>
          </div>
        </div>

        <div class="card bg-base-100 shadow-xl">
          <div class="card-body">
            <h2 class="card-title text-primary">Comunidade</h2>
            <p>Eventos mensais e ambiente acolhedor para jogadores de todos os níveis.</p>
          </div>
        </div>
      </div>

      <div class="text-center mt-8">
        <Button href="/eventos"> Veja os próximos eventos </Button>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener("touchstart", (e) => {
      if (!(e.target as Element | null)?.closest(".animated-carousel")) {
        (document.activeElement as HTMLElement | null)?.blur();
      }
    });
  </script>

  <Footer />
</BaseLayout>
